# Прототип RAG-системы для анализа нормативных документов

## Краткое описание
RAG-cистема сочетает поиск по векторной базе знаний (retrieval) с генерацией ответов LLM (generation).

RAG-система ориентирована на работу с нормативными документами (например, СП 20.13330.2016), чтобы отвечать
на технические вопросы в области проектирования, строительства и эксплуатации промышленных объектов
(например, вопросы о зонах, коэффициентах, нагрузках и т.д.). 
Обрабатывает текст, таблицы, изображения, формулы.

## Состав проекта
### Основные модули

* Логика представлена в виде прототипа в файле "rag_srv_proto.ipynb" (секция "__main__")


* В директориях "faiss_index" и "images" хранятся индекс и изображения из НТД (для примера из файла "СП 20.13330.2016 2024-09-05.docx")


* В алгоритме проекта используются файлы кеша и логов: "chunks.json", "image_cache.json", "links.json", "rag_cache.json", "messages_log.json", "context_log.txt"

### Дополнительные файлы

* Презентация прототипа RAG-системы с кратким описанием (цель, задачи, алгоритм, результаты и др.) - "RAG_system_prototype.pdf"


* Детальный алгоритм работы RAG-системы - "RAG_system_prototype.drawio"


* файл НТД - "СП 20.13330.2016 2024-09-05.docx"


## Работа RAG-системы
* Выбрать вопросы (в качестве примера используется документ в корне проекта - "СП 20.13330.2016 2024-09-05.docx") и запустить на исполнение основной алгоритм "rag_srv_proto.ipynb" (секция "__main__")


* Если необходимо заново запустить процессы поиска информации по индексу и LLM-генерации, то перед исполнением основной логики следует удалить файл "rag_cache.json". При этом часть информации загрузится из векторного хранилища и кеша, которые были сформированы при оцифровке документа.


* Если требуется произвести оцифровку документа с нуля и пересоздание хранилища, кеша и логов, то следует удалить "faiss_index", "images" и все файлы кеша и логов (см. выше)


## Вопросы для демонстрации:
1 В каких зонах по весу снегового покрова находятся Херсон и Мелитополь?

2 Какие регионы Российской Федерации имеют высотный коэффициент k_h, превышающий 2?

3 Какой коэффициент надежности по нагрузке для металлических конструкций?

4 Как определяется нормативное значение основной ветровой нагрузки w?

5 Что такое коэффициент надежности по нагрузке?

## Работа RAG-системы: ответы на вопросы

-----------------------------------------------------------------------------
*❓ Вопрос 1*: 

В каких зонах по весу снегового покрова находятся Херсон и Мелитополь?

*Ответ*: 

Херсон находится в зоне I, а Мелитополь в зоне II по весу снегового покрова. Источник: КАРТА 1, В.

*Источники*:
- СП 20.13330.2016 2024-09-05.docx: КАРТА 1, в. РАЙОНИРОВАНИЕ ТЕРРИТОРИИ ДОНЕЦКОЙ НАРОДНОЙ РЕСПУБЛИКИ, ЛУГАНСКОЙ НАРОДНОЙ РЕСПУБЛИКИ, ЗАПОРОЖСКОЙ ОБЛАСТИ, ХЕРСОНСКОЙ ОБЛАСТИ ПО ВЕСУ СНЕГОВОГО ПОКРОВА (ДОПОЛНЕНИЕ К КАРТЕ 1. РАЙОНИРОВАНИЕ ТЕРРИТОРИИ РОССИЙСКОЙ ФЕДЕРАЦИИ ПО ВЕСУ СНЕГОВОГО ПОКРОВА) (image, релевантность: 0.873);

-----------------------------------------------------------------------------
*❓ Вопрос 2*: 

Какие регионы Российской Федерации имеют высотный коэффициент k_h, превышающий 2?

*Ответ*: 

Регионы Российской Федерации с высотным коэффициентом \( k_h \), превышающим 2, включают:

1. Краснодарский край (Адлерский район) - \( k_h = 2,15 \)
2. Республика Адыгея (Адыгея) - \( k_h = 2,15 \)
3. Красноярский край (Кемеровская область - Кузбасс, Кузнецкий Алатау, Горная Шория) - \( k_h = 2,25 \)
4. Красноярский край (Саянский хр., Куртушибинский хр.) - \( k_h = 3,15 \)
5. Норильский промышленный район (до 20 км к югу от г. Норильска) - \( k_h = 2,5 \)
6. Норильский промышленный район (к северо-востоку от г. Норильска) - \( k_h = 3,75 \)
7. Республика Бурятия (Байкальский хр.) - \( k_h = 2,3 \)

Источник: Таблица 49.

*Источники*:
- СП 20.13330.2016 2024-09-05.docx: Таблица 49 (table, релевантность: 0.964); КАРТА 1. РАЙОНИРОВАНИЕ ТЕРРИТОРИИ РОССИЙСКОЙ ФЕДЕРАЦИИ ПО ВЕСУ СНЕГОВОГО ПОКРОВА (formula, релевантность: 0.936); Таблица 11.2 (formula, релевантность: 0.930)

-----------------------------------------------------------------------------
*❓ Вопрос 3*:

Какой коэффициент надежности по нагрузке для металлических конструкицй?

*Ответ*:

Коэффициент надежности по нагрузке для металлических конструкций составляет 1,05 (Таблица 1).

*Источники*:
- СП 20.13330.2016 2024-09-05.docx: Таблица 1 (table, релевантность: 0.980); Таблица 3 (table, релевантность: 0.964); Таблица 26 (table, релевантность: 0.959); Для различных участков конструкций (рисунок В.1) коэффициент cx определяется по таблице В.1; (image, релевантность: 0.886)

-----------------------------------------------------------------------------
*❓ Вопрос 4*: 

Как определяется нормативное значение основной ветровой нагрузки w?

*Ответ*:

Нормативное значение основной ветровой нагрузки w определяется как сумма средней составляющей ветровой нагрузки wm и пульсационной составляющей wg, по формуле: 

w = wm + wg. (11.1)

*Источник*: 

- СП 20.13330.2016, раздел 11.1.2.

-----------------------------------------------------------------------------
*❓ Вопрос 5*: 

Что такое коэффициент надежности по нагрузке?

*Ответ*:

Коэффициент надежности по нагрузке — это коэффициент, учитывающий в условиях нормальной эксплуатации сооружений возможное отклонение нагрузок в неблагоприятную (большую или меньшую) сторону от нормативных значений (СП 20.13330.2016, п. 3.2).

*Источники*:
- СП 20.13330.2016 2024-09-05.docx: Таблица 3 (table, релевантность: 0.951); Таблица 1 (table, релевантность: 0.951); Рисунок 11.1 - Коэффициенты динамичности
(в ред. Изменения N 1, утв. Приказом
Минстроя России от 05.07.2018 N 402/пр) (formula, релевантность: 0.918)
-----------------------------------------------------------------------------

##  TODO
* Добавить мульти-файлы, масштабирование
* Fine-tune embeddings
* Улучшенный кеш
* R&D, перевод на offline-LLM
* Оптимизация логики и скорости работы 
* etc