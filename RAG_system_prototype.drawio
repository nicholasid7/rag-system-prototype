<mxfile host="app.diagrams.net" agent="Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/138.0.0.0 Safari/537.36" version="28.2.3">
  <diagram name="Page-1" id="y7FNM9cHMXZOr_l5Tzo8">
    <mxGraphModel grid="0" page="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" pageScale="1" pageWidth="850" pageHeight="1100" math="0" shadow="0">
      <root>
        <mxCell id="0" />
        <mxCell id="1" parent="0" />
        <mxCell id="4bfqSahwpxb0eaGGro3T-8" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;" edge="1" parent="1" source="4bfqSahwpxb0eaGGro3T-2" target="4bfqSahwpxb0eaGGro3T-6">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="4bfqSahwpxb0eaGGro3T-2" value="S" style="ellipse;whiteSpace=wrap;html=1;aspect=fixed;" vertex="1" parent="1">
          <mxGeometry x="280" y="30" width="40" height="40" as="geometry" />
        </mxCell>
        <mxCell id="4bfqSahwpxb0eaGGro3T-3" value="E" style="ellipse;whiteSpace=wrap;html=1;aspect=fixed;" vertex="1" parent="1">
          <mxGeometry x="280" y="1930" width="40" height="40" as="geometry" />
        </mxCell>
        <mxCell id="4bfqSahwpxb0eaGGro3T-4" value="&lt;p style=&quot;white-space-collapse: preserve;&quot; dir=&quot;auto&quot;&gt;&lt;span style=&quot;background-color: transparent; color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));&quot;&gt;Загрузка кэша&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;white-space-collapse: preserve;&quot; dir=&quot;auto&quot;&gt;(FAISS.load_local, JSON links)&lt;/p&gt;" style="rounded=0;whiteSpace=wrap;html=1;" vertex="1" parent="1">
          <mxGeometry x="510" y="267" width="140" height="69" as="geometry" />
        </mxCell>
        <mxCell id="4bfqSahwpxb0eaGGro3T-5" value="&lt;div style=&quot;line-height: 90%;&quot;&gt;&lt;p dir=&quot;auto&quot; style=&quot;white-space-collapse: preserve;&quot;&gt;Существуют ли кэш&lt;/p&gt;&lt;p dir=&quot;auto&quot; style=&quot;white-space-collapse: preserve;&quot;&gt; (FAISS индекс, &lt;/p&gt;&lt;p dir=&quot;auto&quot; style=&quot;white-space-collapse: preserve;&quot;&gt;изображения, links)&lt;/p&gt;&lt;/div&gt;" style="rhombus;whiteSpace=wrap;html=1;" vertex="1" parent="1">
          <mxGeometry x="182.5" y="236" width="235" height="130" as="geometry" />
        </mxCell>
        <mxCell id="4bfqSahwpxb0eaGGro3T-6" value="&lt;p style=&quot;white-space-collapse: preserve;&quot; dir=&quot;auto&quot;&gt;Путь к DOCX файлу (DOC_PATH), &lt;/p&gt;&lt;p style=&quot;white-space-collapse: preserve;&quot; dir=&quot;auto&quot;&gt;Вопрос пользователя (question)&lt;/p&gt;" style="shape=parallelogram;perimeter=parallelogramPerimeter;whiteSpace=wrap;html=1;fixedSize=1;" vertex="1" parent="1">
          <mxGeometry x="165" y="120" width="270" height="60" as="geometry" />
        </mxCell>
        <mxCell id="4bfqSahwpxb0eaGGro3T-7" value="" style="endArrow=classic;html=1;rounded=0;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" edge="1" parent="1" source="4bfqSahwpxb0eaGGro3T-5" target="4bfqSahwpxb0eaGGro3T-4">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="435" y="296" as="sourcePoint" />
            <mxPoint x="485" y="246" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="4bfqSahwpxb0eaGGro3T-9" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;" edge="1" parent="1" source="4bfqSahwpxb0eaGGro3T-6" target="4bfqSahwpxb0eaGGro3T-5">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="330" y="210" as="sourcePoint" />
            <mxPoint x="330" y="260" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="4bfqSahwpxb0eaGGro3T-10" value="T" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;" vertex="1" parent="1">
          <mxGeometry x="410" y="271" width="30" height="30" as="geometry" />
        </mxCell>
        <mxCell id="4bfqSahwpxb0eaGGro3T-13" value="" style="endArrow=classic;html=1;rounded=0;exitX=0.5;exitY=1;exitDx=0;exitDy=0;" edge="1" parent="1" source="4bfqSahwpxb0eaGGro3T-5" target="4bfqSahwpxb0eaGGro3T-19">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="400" y="390" as="sourcePoint" />
            <mxPoint x="300" y="430" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="4bfqSahwpxb0eaGGro3T-14" value="F" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;" vertex="1" parent="1">
          <mxGeometry x="300" y="366" width="30" height="30" as="geometry" />
        </mxCell>
        <mxCell id="hODQYmgnG3JCPrlogseP-13" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" edge="1" parent="1" source="4bfqSahwpxb0eaGGro3T-15" target="4bfqSahwpxb0eaGGro3T-20">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="4bfqSahwpxb0eaGGro3T-15" value="&lt;p style=&quot;white-space-collapse: preserve;&quot; dir=&quot;auto&quot;&gt;Группировка и чанкинг (group_by_section)&lt;/p&gt;" style="rounded=0;whiteSpace=wrap;html=1;" vertex="1" parent="1">
          <mxGeometry x="160" y="804" width="280" height="76" as="geometry" />
        </mxCell>
        <mxCell id="4bfqSahwpxb0eaGGro3T-18" value="&lt;span style=&quot;white-space: pre-wrap;&quot;&gt;vectorstore, &lt;/span&gt;&lt;span style=&quot;color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255)); white-space: pre-wrap; background-color: transparent;&quot;&gt;links, fallback_used&lt;/span&gt;" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;" vertex="1" parent="1">
          <mxGeometry x="245" y="570" width="190" height="30" as="geometry" />
        </mxCell>
        <mxCell id="4bfqSahwpxb0eaGGro3T-19" value="&lt;p style=&quot;white-space-collapse: preserve;&quot; dir=&quot;auto&quot;&gt;Извлечение из DOCX (extract_from_docx)&lt;/p&gt;" style="rounded=0;whiteSpace=wrap;html=1;" vertex="1" parent="1">
          <mxGeometry x="157" y="435" width="285" height="80" as="geometry" />
        </mxCell>
        <mxCell id="hODQYmgnG3JCPrlogseP-15" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" edge="1" parent="1" source="4bfqSahwpxb0eaGGro3T-20" target="4bfqSahwpxb0eaGGro3T-33">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="4bfqSahwpxb0eaGGro3T-20" value="&lt;p style=&quot;white-space-collapse: preserve;&quot; dir=&quot;auto&quot;&gt;Построение индекса (&lt;b&gt;build_index&lt;/b&gt;)&lt;/p&gt;" style="rounded=0;whiteSpace=wrap;html=1;" vertex="1" parent="1">
          <mxGeometry x="220" y="950" width="160" height="80" as="geometry" />
        </mxCell>
        <mxCell id="4bfqSahwpxb0eaGGro3T-21" value="&lt;div style=&quot;line-height: 90%;&quot;&gt;&lt;p style=&quot;white-space-collapse: preserve;&quot; dir=&quot;auto&quot;&gt;Ошибка парсинга?&lt;/p&gt;&lt;/div&gt;" style="rhombus;whiteSpace=wrap;html=1;" vertex="1" parent="1">
          <mxGeometry x="216.25" y="640" width="167.5" height="100" as="geometry" />
        </mxCell>
        <mxCell id="4bfqSahwpxb0eaGGro3T-22" value="" style="endArrow=classic;html=1;rounded=0;exitX=0.5;exitY=1;exitDx=0;exitDy=0;" edge="1" parent="1" source="4bfqSahwpxb0eaGGro3T-19" target="4bfqSahwpxb0eaGGro3T-21">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="500" y="620" as="sourcePoint" />
            <mxPoint x="500" y="684" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="4bfqSahwpxb0eaGGro3T-23" value="" style="endArrow=classic;html=1;rounded=0;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" edge="1" parent="1" source="4bfqSahwpxb0eaGGro3T-21" target="4bfqSahwpxb0eaGGro3T-26">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="391.75" y="690" as="sourcePoint" />
            <mxPoint x="480" y="690" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="4bfqSahwpxb0eaGGro3T-24" value="T" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;" vertex="1" parent="1">
          <mxGeometry x="378.75" y="662" width="30" height="30" as="geometry" />
        </mxCell>
        <mxCell id="hODQYmgnG3JCPrlogseP-47" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=1;entryY=0.25;entryDx=0;entryDy=0;" edge="1" parent="1" source="4bfqSahwpxb0eaGGro3T-26" target="4bfqSahwpxb0eaGGro3T-15">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="4bfqSahwpxb0eaGGro3T-26" value="&lt;p style=&quot;white-space-collapse: preserve;&quot; dir=&quot;auto&quot;&gt;&lt;span style=&quot;background-color: transparent; color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));&quot;&gt;Fallback-режим&lt;/span&gt;&lt;/p&gt;" style="rounded=0;whiteSpace=wrap;html=1;" vertex="1" parent="1">
          <mxGeometry x="425" y="650" width="117" height="80" as="geometry" />
        </mxCell>
        <mxCell id="4bfqSahwpxb0eaGGro3T-29" value="&lt;span style=&quot;white-space: pre-wrap;&quot;&gt;vectorstore, &lt;/span&gt;&lt;span style=&quot;color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255)); white-space: pre-wrap; background-color: transparent;&quot;&gt;links, fallback_used&lt;/span&gt;" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;" vertex="1" parent="1">
          <mxGeometry x="526" y="350" width="190" height="30" as="geometry" />
        </mxCell>
        <mxCell id="4bfqSahwpxb0eaGGro3T-30" value="" style="endArrow=classic;html=1;rounded=0;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=1;entryY=0.5;entryDx=0;entryDy=0;edgeStyle=orthogonalEdgeStyle;" edge="1" parent="1" source="4bfqSahwpxb0eaGGro3T-4" target="4bfqSahwpxb0eaGGro3T-33">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="580" y="440" as="sourcePoint" />
            <mxPoint x="579.5" y="594" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="4bfqSahwpxb0eaGGro3T-31" value="" style="endArrow=classic;html=1;rounded=0;exitX=0.5;exitY=1;exitDx=0;exitDy=0;" edge="1" parent="1" source="4bfqSahwpxb0eaGGro3T-21" target="4bfqSahwpxb0eaGGro3T-15">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="500" y="850" as="sourcePoint" />
            <mxPoint x="500" y="930" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="hODQYmgnG3JCPrlogseP-25" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" edge="1" parent="1" source="4bfqSahwpxb0eaGGro3T-33" target="hODQYmgnG3JCPrlogseP-19">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="4bfqSahwpxb0eaGGro3T-33" value="&lt;p style=&quot;white-space-collapse: preserve;&quot; dir=&quot;auto&quot;&gt;&lt;strong&gt;RAG-запрос (rag_query)&lt;/strong&gt;&lt;/p&gt;" style="rounded=0;whiteSpace=wrap;html=1;" vertex="1" parent="1">
          <mxGeometry x="160" y="1120" width="280" height="80" as="geometry" />
        </mxCell>
        <mxCell id="hODQYmgnG3JCPrlogseP-1" value="Парсинг DOCX: получение текста (по параграфам/заголовкам), &#xa;таблицы (в Markdown via Pandas), изображения (из ZIP, конверт в PNG, &#xa;OCR для формул), links (regex). &#xa;Группировка по секциям. Кэширование в JSON (images, chunks, links)" style="strokeWidth=2;shape=mxgraph.flowchart.annotation_1;align=left;pointerEvents=1;spacing=10;textShadow=0;labelBorderColor=none;" vertex="1" parent="1">
          <mxGeometry x="517" y="433" width="16" height="84.5" as="geometry" />
        </mxCell>
        <mxCell id="hODQYmgnG3JCPrlogseP-2" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0;entryY=0.5;entryDx=0;entryDy=0;entryPerimeter=0;endArrow=none;endFill=0;dashed=1;dashPattern=8 8;" edge="1" parent="1" source="4bfqSahwpxb0eaGGro3T-19" target="hODQYmgnG3JCPrlogseP-1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="hODQYmgnG3JCPrlogseP-3" value="F" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;" vertex="1" parent="1">
          <mxGeometry x="300" y="740" width="30" height="30" as="geometry" />
        </mxCell>
        <mxCell id="hODQYmgnG3JCPrlogseP-5" value="Извлечь сырой текст, разбить на chunks. &#xa;Добавить в documents как text" style="strokeWidth=2;shape=mxgraph.flowchart.annotation_1;align=left;pointerEvents=1;spacing=10;textShadow=0;labelBorderColor=none;" vertex="1" parent="1">
          <mxGeometry x="602" y="660" width="16" height="60" as="geometry" />
        </mxCell>
        <mxCell id="hODQYmgnG3JCPrlogseP-6" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0;entryY=0.5;entryDx=0;entryDy=0;entryPerimeter=0;endArrow=none;endFill=0;dashed=1;dashPattern=8 8;exitX=1;exitY=0.5;exitDx=0;exitDy=0;" edge="1" parent="1" source="4bfqSahwpxb0eaGGro3T-26" target="hODQYmgnG3JCPrlogseP-5">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="660" y="670" as="sourcePoint" />
            <mxPoint x="731" y="670" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="hODQYmgnG3JCPrlogseP-7" value="Группировать documents по section/subsection/type. &#xa;Агрегировать keywords, links. Разбить текст на chunks &#xa;(RecursiveCharacterTextSplitter: size=500, overlap=100). &#xa;Добавить таблицы/изображения/формулы целиком" style="strokeWidth=2;shape=mxgraph.flowchart.annotation_1;align=left;pointerEvents=1;spacing=10;textShadow=0;labelBorderColor=none;" vertex="1" parent="1">
          <mxGeometry x="602" y="798" width="16" height="88" as="geometry" />
        </mxCell>
        <mxCell id="hODQYmgnG3JCPrlogseP-8" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0;entryY=0.5;entryDx=0;entryDy=0;entryPerimeter=0;endArrow=none;endFill=0;dashed=1;dashPattern=8 8;" edge="1" parent="1" source="4bfqSahwpxb0eaGGro3T-15" target="hODQYmgnG3JCPrlogseP-7">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="510" y="842" as="sourcePoint" />
            <mxPoint x="699" y="822" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="hODQYmgnG3JCPrlogseP-11" value="Создать FAISS из chunks (батчинг по N). &#xa;Embeddings: OpenAI &#39;text-embedding-ada-002&#39;. &#xa;Сохранить локально" style="strokeWidth=2;shape=mxgraph.flowchart.annotation_1;align=left;pointerEvents=1;spacing=10;textShadow=0;labelBorderColor=none;" vertex="1" parent="1">
          <mxGeometry x="440.75" y="953" width="16" height="88" as="geometry" />
        </mxCell>
        <mxCell id="hODQYmgnG3JCPrlogseP-12" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0;entryY=0.5;entryDx=0;entryDy=0;entryPerimeter=0;endArrow=none;endFill=0;dashed=1;dashPattern=8 8;exitX=0.981;exitY=0.588;exitDx=0;exitDy=0;exitPerimeter=0;" edge="1" parent="1" source="4bfqSahwpxb0eaGGro3T-20" target="hODQYmgnG3JCPrlogseP-11">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="380" y="994" as="sourcePoint" />
            <mxPoint x="642.75" y="974" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="hODQYmgnG3JCPrlogseP-16" value="Проверить кэш ответа (RAG_CACHE_FILE). &#xa;Если нет: Retrieval (FAISS similarity, k=30). &#xa;Фильтрация (cosine_similarity &gt;0.75, boosts для keywords/type)" style="strokeWidth=2;shape=mxgraph.flowchart.annotation_1;align=left;pointerEvents=1;spacing=10;textShadow=0;labelBorderColor=none;" vertex="1" parent="1">
          <mxGeometry x="602" y="1136" width="16" height="88" as="geometry" />
        </mxCell>
        <mxCell id="hODQYmgnG3JCPrlogseP-17" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0;entryY=0.5;entryDx=0;entryDy=0;entryPerimeter=0;endArrow=none;endFill=0;dashed=1;dashPattern=8 8;exitX=1;exitY=0.75;exitDx=0;exitDy=0;" edge="1" parent="1" source="4bfqSahwpxb0eaGGro3T-33" target="hODQYmgnG3JCPrlogseP-16">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="570" y="1304" as="sourcePoint" />
            <mxPoint x="835.75" y="1281" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="hODQYmgnG3JCPrlogseP-19" value="&lt;div style=&quot;line-height: 90%;&quot;&gt;&lt;p style=&quot;white-space-collapse: preserve;&quot; dir=&quot;auto&quot;&gt;Тип: image/table/formula/text?&lt;/p&gt;&lt;/div&gt;" style="rhombus;whiteSpace=wrap;html=1;" vertex="1" parent="1">
          <mxGeometry x="198" y="1260" width="203.75" height="100" as="geometry" />
        </mxCell>
        <mxCell id="hODQYmgnG3JCPrlogseP-20" value="" style="endArrow=classic;html=1;rounded=0;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" edge="1" parent="1" target="hODQYmgnG3JCPrlogseP-22">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="402.75" y="1310" as="sourcePoint" />
            <mxPoint x="499" y="1310" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="hODQYmgnG3JCPrlogseP-38" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=1;entryY=0.5;entryDx=0;entryDy=0;exitX=0.5;exitY=1;exitDx=0;exitDy=0;" edge="1" parent="1" source="hODQYmgnG3JCPrlogseP-22" target="hODQYmgnG3JCPrlogseP-34">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="hODQYmgnG3JCPrlogseP-22" value="&lt;p style=&quot;white-space-collapse: preserve;&quot; dir=&quot;auto&quot;&gt;Обработка изображений&lt;/p&gt;" style="rounded=0;whiteSpace=wrap;html=1;" vertex="1" parent="1">
          <mxGeometry x="461" y="1270" width="117" height="80" as="geometry" />
        </mxCell>
        <mxCell id="hODQYmgnG3JCPrlogseP-23" value="" style="endArrow=classic;html=1;rounded=0;exitX=0.5;exitY=1;exitDx=0;exitDy=0;" edge="1" parent="1" source="hODQYmgnG3JCPrlogseP-19" target="hODQYmgnG3JCPrlogseP-33">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="500" y="1470" as="sourcePoint" />
            <mxPoint x="300" y="1424" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="hODQYmgnG3JCPrlogseP-26" value="&lt;p dir=&quot;auto&quot; style=&quot;white-space: pre-wrap;&quot;&gt;Image&lt;/p&gt;" style="text;whiteSpace=wrap;html=1;" vertex="1" parent="1">
          <mxGeometry x="401.75" y="1270" width="70" height="60" as="geometry" />
        </mxCell>
        <mxCell id="hODQYmgnG3JCPrlogseP-27" value="&lt;p dir=&quot;auto&quot; style=&quot;white-space: pre-wrap;&quot;&gt;&lt;span style=&quot;text-align: center;&quot;&gt;table/formula&lt;/span&gt;&lt;/p&gt;" style="text;whiteSpace=wrap;html=1;" vertex="1" parent="1">
          <mxGeometry x="308.75" y="1350" width="70" height="60" as="geometry" />
        </mxCell>
        <mxCell id="hODQYmgnG3JCPrlogseP-28" value="&lt;p dir=&quot;auto&quot; style=&quot;white-space: pre-wrap;&quot;&gt;text&lt;/p&gt;" style="text;whiteSpace=wrap;html=1;" vertex="1" parent="1">
          <mxGeometry x="165" y="1270" width="70" height="60" as="geometry" />
        </mxCell>
        <mxCell id="hODQYmgnG3JCPrlogseP-29" value="" style="endArrow=classic;html=1;rounded=0;exitX=0;exitY=0.5;exitDx=0;exitDy=0;entryX=1;entryY=0.5;entryDx=0;entryDy=0;" edge="1" parent="1" source="hODQYmgnG3JCPrlogseP-19" target="hODQYmgnG3JCPrlogseP-36">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="230" y="1380" as="sourcePoint" />
            <mxPoint x="90" y="1310" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="hODQYmgnG3JCPrlogseP-31" value="Конверт в base64, &#xa;LLM-анализ (System/HumanMessage с image_url).&#xa; Добавить анализ в context" style="strokeWidth=2;shape=mxgraph.flowchart.annotation_1;align=left;pointerEvents=1;spacing=10;textShadow=0;labelBorderColor=none;" vertex="1" parent="1">
          <mxGeometry x="602" y="1266" width="16" height="88" as="geometry" />
        </mxCell>
        <mxCell id="hODQYmgnG3JCPrlogseP-32" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0;entryY=0.5;entryDx=0;entryDy=0;entryPerimeter=0;endArrow=none;endFill=0;dashed=1;dashPattern=8 8;exitX=1;exitY=0.5;exitDx=0;exitDy=0;" edge="1" parent="1" source="hODQYmgnG3JCPrlogseP-22" target="hODQYmgnG3JCPrlogseP-31">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="480" y="1310" as="sourcePoint" />
            <mxPoint x="875.75" y="1411" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="hODQYmgnG3JCPrlogseP-35" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" edge="1" parent="1" source="hODQYmgnG3JCPrlogseP-33" target="hODQYmgnG3JCPrlogseP-34">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="hODQYmgnG3JCPrlogseP-33" value="&lt;p style=&quot;white-space-collapse: preserve;&quot; dir=&quot;auto&quot;&gt;Обработка таблиц/формул&lt;/p&gt;" style="rounded=0;whiteSpace=wrap;html=1;" vertex="1" parent="1">
          <mxGeometry x="241" y="1420" width="117" height="80" as="geometry" />
        </mxCell>
        <mxCell id="hODQYmgnG3JCPrlogseP-42" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" edge="1" parent="1" source="hODQYmgnG3JCPrlogseP-34" target="hODQYmgnG3JCPrlogseP-41">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="hODQYmgnG3JCPrlogseP-34" value="&lt;p style=&quot;white-space-collapse: preserve;&quot; dir=&quot;auto&quot;&gt;Сбор контекста и генерация&lt;/p&gt;" style="rounded=0;whiteSpace=wrap;html=1;" vertex="1" parent="1">
          <mxGeometry x="241" y="1556" width="117" height="80" as="geometry" />
        </mxCell>
        <mxCell id="hODQYmgnG3JCPrlogseP-37" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0;entryY=0.5;entryDx=0;entryDy=0;exitX=0.5;exitY=1;exitDx=0;exitDy=0;" edge="1" parent="1" source="hODQYmgnG3JCPrlogseP-36" target="hODQYmgnG3JCPrlogseP-34">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="hODQYmgnG3JCPrlogseP-36" value="&lt;p style=&quot;white-space-collapse: preserve;&quot; dir=&quot;auto&quot;&gt;Обработка текста&lt;/p&gt;" style="rounded=0;whiteSpace=wrap;html=1;" vertex="1" parent="1">
          <mxGeometry x="22" y="1270" width="117" height="80" as="geometry" />
        </mxCell>
        <mxCell id="hODQYmgnG3JCPrlogseP-39" value="Собрать context (анализ изображений + описания + таблицы + формулы + текст). &#xa;Обрезать по токенам. LLM-invoke (prompt с приоритетом таблиц/изображений). &#xa;Добавить источники (из metadata)&#xa;Fallback LLM" style="strokeWidth=2;shape=mxgraph.flowchart.annotation_1;align=left;pointerEvents=1;spacing=10;textShadow=0;labelBorderColor=none;" vertex="1" parent="1">
          <mxGeometry x="435" y="1492" width="16" height="88" as="geometry" />
        </mxCell>
        <mxCell id="hODQYmgnG3JCPrlogseP-40" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0;entryY=0.5;entryDx=0;entryDy=0;entryPerimeter=0;endArrow=none;endFill=0;dashed=1;dashPattern=8 8;exitX=1;exitY=0.25;exitDx=0;exitDy=0;" edge="1" parent="1" source="hODQYmgnG3JCPrlogseP-34" target="hODQYmgnG3JCPrlogseP-39">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="419" y="1514" as="sourcePoint" />
            <mxPoint x="697.75" y="1615" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="hODQYmgnG3JCPrlogseP-45" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" edge="1" parent="1" source="hODQYmgnG3JCPrlogseP-41" target="hODQYmgnG3JCPrlogseP-43">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="hODQYmgnG3JCPrlogseP-41" value="&lt;p style=&quot;white-space-collapse: preserve;&quot; dir=&quot;auto&quot;&gt;&lt;strong&gt;Сохранение кэша&lt;/strong&gt;&lt;/p&gt;" style="rounded=0;whiteSpace=wrap;html=1;" vertex="1" parent="1">
          <mxGeometry x="241" y="1710" width="117" height="80" as="geometry" />
        </mxCell>
        <mxCell id="hODQYmgnG3JCPrlogseP-46" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" edge="1" parent="1" source="hODQYmgnG3JCPrlogseP-43" target="4bfqSahwpxb0eaGGro3T-3">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="hODQYmgnG3JCPrlogseP-43" value="&lt;p style=&quot;white-space-collapse: preserve;&quot; dir=&quot;auto&quot;&gt;Вывод: full_answer (ответ + источники). &lt;/p&gt;&lt;p style=&quot;white-space-collapse: preserve;&quot; dir=&quot;auto&quot;&gt;Логи: context_log.txt, messages_log.json&lt;/p&gt;" style="shape=parallelogram;perimeter=parallelogramPerimeter;whiteSpace=wrap;html=1;fixedSize=1;" vertex="1" parent="1">
          <mxGeometry x="164.5" y="1834" width="270" height="60" as="geometry" />
        </mxCell>
      </root>
    </mxGraphModel>
  </diagram>
</mxfile>
